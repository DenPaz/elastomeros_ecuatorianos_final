{% extends "account/_base.html" %}

{% load i18n %}
{% load allauth %}
{% load widget_tweaks %}

{% block title %}
  {% trans "Change password" %}
{% endblock title %}
{% block content_header %}
  {% url 'account_reset_password' as password_reset_url %}
  <div class="vstack align-items-center gap-2 mb-6">
    <h1>
      {% if token_fail %}
        {% trans "Bad token" %}
      {% else %}
        {% trans "Change password" %}
      {% endif %}
    </h1>
    <p>
      {% if token_fail %}
        {% blocktrans trimmed %}
          The password reset link was invalid, possibly because it has already been used. Please request a <a href="{{ password_reset_url }}">new password reset</a>.
        {% endblocktrans %}
      {% else %}
        {% blocktrans trimmed %}
          Use 8 or more characters with a mix of letters (uppercase and
          lowercase), numbers & symbols.
        {% endblocktrans %}
      {% endif %}
    </p>
  </div>
{% endblock content_header %}
{% block content_body %}
  {% url 'store:index' as home_url %}
  {% url 'account_login' as login_url %}
  {% if not token_fail %}
    {{ block.super }}
    {% trans "Password" as password_label %}
    {% trans "Confirm password" as password2_label %}
    {% with WIDGET_ERROR_CLASS="border-danger" %}
      <form method="post" class="vstack gap-6" action="." novalidate>
        {% csrf_token %}
        {{ redirect_field }}
        <div class="vstack gap-1">
          <div class="password-toggle">
            {% render_field form.password1 class="form-control form-control-lg" placeholder=password_label autofocus="autofocus" autocomplete="new-password" %}
            <label class="password-toggle-btn">
              <input type="checkbox" class="password-toggle-check" />
              <span class="password-toggle-indicator"></span>
            </label>
          </div>
          {% if form.password1.errors %}
            <div class="invalid-feedback d-block">
              <ul class="list-unstyled mb-0">
                {% for error in form.password1.errors %}
                  <li>
                    {{ error }}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </div>
        <div class="vstack gap-1">
          <div class="password-toggle">
            {% render_field form.password2 class="form-control form-control-lg" placeholder=password2_label autocomplete="new-password" %}
            <label class="password-toggle-btn">
              <input type="checkbox" class="password-toggle-check" />
              <span class="password-toggle-indicator"></span>
            </label>
          </div>
          {% if form.password2.errors %}
            <div class="invalid-feedback d-block">
              <ul class="list-unstyled mb-0">
                {% for error in form.password2.errors %}
                  <li>
                    {{ error }}
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        </div>
        <button type="submit" class="btn btn-lg btn-primary">
          {% trans "Change password" %}
        </button>
        {% if user.is_authenticated %}
          <a href="{{ home_url }}" class="btn btn-lg btn-secondary">
            {% trans "Return to home" %}
          </a>
        {% else %}
          <a href="{{ login_url }}" class="btn btn-lg btn-secondary">
            {% trans "Return to login" %}
          </a>
        {% endif %}
      </form>
    {% endwith %}
  {% else %}
    <div class="vstack gap-6">
      {% if user.is_authenticated %}
        <a href="{{ home_url }}" class="btn btn-lg btn-secondary">
          {% trans "Return to home" %}
        </a>
      {% else %}
        <a href="{{ login_url }}" class="btn btn-lg btn-secondary">
          {% trans "Return to login" %}
        </a>
      {% endif %}
    </div>
  {% endif %}
{% endblock content_body %}
